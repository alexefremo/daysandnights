<h1>Listing places</h1>

<table>
  <thead>
    <tr>
      <th>Subscription</th>
      <th>Photo</th>
      <th>Title</th>
      <th>Place type</th>
      <th>Content</th>
      <th>Address</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @places.each do |place| %>
      <tr>
        <td>
        All subscriptions: <%= Subscription.where(place_id: place.id).count %> 
        Males: <%= Subscription.where(user_gender: 'Male', place_id: place.id).count %> 
        Females: <%= Subscription.where(user_gender: 'Female', place_id: place.id).count %>
        </td>
        <td>
	<% if user_signed_in? %>
        <% if current_user.right == 'user' %>
        <% if Subscription.exists?(user_id: current_user.id, place_id: place.id) %>
        <%= button_to "unsubscribe", :controller => :places, 
                                     :action => 'delid',
                                     :plid => place.id,
                                     :method => :post %>

        <% else %>
        <%= button_to "subscribe", :controller => :places, 
                                   :action => 'addid',
                                   :plid => place.id,
                                   :method => :post %>
        <% end %>
        <% end %>
        <% else %>
        <%= button_to "subscribe", user_session_path %>
        <% end %>
        </td>
        <td><p><%= image_tag place.place_photo(:small) %></td>
        <td><%= place.title %></td>
        <td><%= place.place_type.title %></td>
        <td><%= place.content %></td>
        <td><%= place.address %></td>
        <td><%= link_to 'Show', place %></td>
        <td><%= link_to 'Edit', edit_place_path(place) %></td>
        <td><%= link_to 'Destroy', place, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Place', new_place_path %>
